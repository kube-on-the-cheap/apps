image:
  repository: ghcr.io/zitadel/zitadel
  tag: v4.8.0

zitadel:
  # Masterkey is provided via ExternalSecret
  masterkeySecretName: zitadel-masterkey

  configmapConfig:
    ExternalDomain: auth.cloud.blacksd.tech
    ExternalSecure: true
    ExternalPort: 443

    TLS:
      Enabled: false

    DefaultInstance:
      SMTPConfiguration:
        SMTP:
          Host: smtp.email.eu-frankfurt-1.oci.oraclecloud.com:587
          User: "" # Set via env var ZITADEL_DEFAULTINSTANCE_SMTPCONFIGURATION_SMTP_USER
          Password: "" # Set via env var ZITADEL_DEFAULTINSTANCE_SMTPCONFIGURATION_SMTP_PASSWORD
        TLS: true
        From: do-not-reply@mail.cloud.blacksd.tech
        FromName: Zitadel Auth

    Database:
      Postgres:
        Host: zitadel-pg-rw.zitadel.svc.cluster.local
        Port: 5432
        Database: zitadel
        MaxOpenConns: 20
        MaxIdleConns: 10
        MaxConnLifetime: 30m
        MaxConnIdleTime: 5m
        User:
          Username: zitadel
          SSL:
            Mode: disable
        Admin:
          Username: postgres
          SSL:
            Mode: disable

replicaCount: 1

resources:
  requests:
    cpu: 100m
    memory: 256Mi
    ephemeral-storage: 1Gi
  limits:
    cpu: 500m
    memory: 512Mi
    ephemeral-storage: 2Gi

ingress:
  enabled: false

login:
  enabled: true
  image:
    repository: ghcr.io/zitadel/zitadel-login
    tag: v4.8.0
  ingress:
    enabled: false
  # Workaround for https://github.com/zitadel/zitadel/issues/11163
  # Required for v4.7.1+ due to stricter origin validation (GHSA-7wfc-4796-gmg5)
  customConfigmapConfig: |
    ZITADEL_SERVICE_USER_TOKEN_FILE="/login-client/pat"
    ZITADEL_API_URL="http://zitadel:8080"
    CUSTOM_REQUEST_HEADERS="Host:auth.cloud.blacksd.tech,X-Zitadel-Public-Host:auth.cloud.blacksd.tech"
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

metrics:
  enabled: true
  # serviceMonitor:
  #   enabled: true

env:
  - name: ZITADEL_DATABASE_POSTGRES_USER_PASSWORD
    valueFrom:
      secretKeyRef:
        name: zitadel-pg-app
        key: password
  - name: ZITADEL_DATABASE_POSTGRES_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: zitadel-pg-superuser
        key: password
  - name: ZITADEL_DEFAULTINSTANCE_SMTPCONFIGURATION_SMTP_USER
    valueFrom:
      secretKeyRef:
        name: email-credentials
        key: username
  - name: ZITADEL_DEFAULTINSTANCE_SMTPCONFIGURATION_SMTP_PASSWORD
    valueFrom:
      secretKeyRef:
        name: email-credentials
        key: password

initJob:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

setupJob:
  machinekeyWriter:
    image:
      repository: docker.io/alpine/k8s
